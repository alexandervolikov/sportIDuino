# Чипы

Система отметки поддерживает следующие типы чипов:
- [Mifare Ultralight C](http://www.nxp.com/documents/data_sheet/MF0ICU2.pdf) на 36 отметок
- [Mifare Classic 1K](https://www.nxp.com/docs/en/data-sheet/MF1S50YYX_V1.pdf) на 42 отметки
- [Mifare Classic 4K](https://www.nxp.com/docs/en/data-sheet/MF1S70YYX_V1.pdf) на 90 отметок
- [NTAG213/215/216](https://www.nxp.com/docs/en/data-sheet/NTAG213_215_216.pdf) на 32/120/216 отметок

Тип используемых чипов система определяет автоматически и может одновременно работать с разными типами чипов.

Рекомендуется использовать чипы NTAG213/215/216.
В виде наклеек данные чипы стоят 6/12/20 рублей, в виде брелков в два раза дороже.

![](/Images/chip.jpg?raw=true "Чипы в виде брелков")

**Важно!** Для надежной работы с данными чипами, которые обладают небольшой по площади антенной,
необходимо заменить индуктивности на более мощные в плате RFID RC522 (см. [Сборка станции отметки](/Doc/ru/BaseStationAssembly.md)).

Чипы Mifare Classic 1K идут в комплекте с модулем RC522.
Памяти данных чипов хватает на 42 отметки. Работают чуть медленнее NTAG.
Память чипов Mifare используется лишь на четверть, так как в их структуре реализованы страницы длиной 16 байт.
И при более плотной записи есть риск потери данных. Структура записи аналогичная NTAG.

Память чипов NTAG213/215/216 разделена структурно на 45/135/231 страниц, в каждой из которых содержится по 4 байта.
В первых 4-х страницах содержится UID и другая служебная информация.
Также служебная информация содержится в последних 5 страницах.
Таким образом, для записи остается 36/126/222 страниц.

### Структура данных

Страницы 4-7 зарезервированы, остальные страницы для отметки.
В 4-ой странице в первых двух байтах содержится программируемый номер чипа.
Далее в третьем байте содержится информация по типу чипа. Он равен 255 для мастер-чипа.
В 4-ом байте версия прошивки.
В пятой странице время инициализации чипа в формате Unixtime
С помощью него восстанавливается первый байт времени в отметки.
Далее две страницы резерва для реализации дополнительных функций на отдельных стартах.
Запись отметки на станции занимает отдельную страницу,
в первый байт которой записывается номер станции, в остальные три байта - младшие байты текущего времени в Unixtime.

![](/Images/ntag.jpg?raw=true)

У мастер-чипов для программирования станций структура отличается.
Станция определяет их по числу 255, записанному в третий байт 4-ой страницы.
Существует 6 разных мастер чипов: времени, номера, сна, настроек, лога и информации.
После считывания информации с мастер-чипа времени или номера на станции, на нём стирается страница 4,
для предотвращения случайного повторного его использования.
Ниже представлена структура мастер-чипов.

![](/Images/master-card-ru.png?raw=true)

